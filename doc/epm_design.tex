% Educational Problem Manager (EPM) Design Manual.
%
% File:         epm_design.tex
% Author:       Bob Walton (walton@acm.org)
% Date:		See \date below.

% The authors have placed EPM (its files and the
% content of these files) in the public domain; they
% make no warranty and accept no liability for EPM.
  
\documentclass[12pt]{article}

\usepackage[T1]{fontenc}
\usepackage{lmodern}
\usepackage{makeidx}

\makeindex

\setlength{\oddsidemargin}{0in}
\setlength{\evensidemargin}{0in}
\setlength{\textwidth}{6.5in}
\setlength{\textheight}{8.5in}
\raggedbottom

\setlength{\unitlength}{1in}

\pagestyle{headings}
\setlength{\parindent}{0.0in}
\setlength{\parskip}{1ex}

\setcounter{secnumdepth}{5}
\setcounter{tocdepth}{5}
\newcommand{\subsubsubsection}[1]{\paragraph[#1]{#1.}}
\newcommand{\subsubsubsubsection}[1]{\subparagraph[#1]{#1.}}

% Begin \tableofcontents surgery.

\newcount\AtCatcode
\AtCatcode=\catcode`@
\catcode `@=11	% @ is now a letter

\renewcommand{\contentsname}{}
\renewcommand\l@section{\@dottedtocline{1}{0.1em}{1.4em}}
\renewcommand\l@table{\@dottedtocline{1}{0.1em}{1.4em}}
\renewcommand\tableofcontents{%
    \begin{list}{}%
	     {\setlength{\itemsep}{0in}%
	      \setlength{\topsep}{0in}%
	      \setlength{\parsep}{1ex}%
	      \setlength{\labelwidth}{0in}%
	      \setlength{\baselineskip}{1.5ex}%
	      \setlength{\leftmargin}{0.8in}%
	      \setlength{\rightmargin}{0.8in}}%
    \item\@starttoc{toc}%
    \end{list}}
\renewcommand\listoftables{%
    \begin{list}{}%
	     {\setlength{\itemsep}{0in}%
	      \setlength{\topsep}{0in}%
	      \setlength{\parsep}{1ex}%
	      \setlength{\labelwidth}{0in}%
	      \setlength{\baselineskip}{1.5ex}%
	      \setlength{\leftmargin}{1.0in}%
	      \setlength{\rightmargin}{1.0in}%
	      }%
    \item\@starttoc{lot}%
    \end{list}}

\catcode `@=\AtCatcode	% @ is now restored

% End \tableofcontents surgery.

\newenvironment{indpar}[1][0.4in]%
	{\begin{list}{}%
		     {\setlength{\itemsep}{0in}%
		      \setlength{\topsep}{0in}%
		      \setlength{\parsep}{1ex}%
		      \setlength{\labelwidth}{#1}%
		      \setlength{\leftmargin}{#1}%
		      \addtolength{\leftmargin}{\labelsep}}%
	 \item}%
	{\end{list}}

\newenvironment{itemlist}[1][0.2in]%
	{\begin{list}{}{\setlength{\labelwidth}{#1}%
		        \setlength{\leftmargin}{\labelwidth}%
		        \addtolength{\leftmargin}{+0.2in}%
		        \addtolength{\linewidth}{-\labelwidth}%
		        \addtolength{\linewidth}{-0.2in}%
		        \renewcommand{\makelabel}[1]{##1\hfill}}
	 \raggedright}%
	{\end{list}}

\newcommand{\TT}[1]{{\tt \bfseries #1}}
\newcommand{\key}[1]{{\bf \em #1}}
\newcommand{\EOL}{\penalty \exhyphenpenalty}
\newcommand{\pagref}[1]{p\pageref{#1}}
\newcommand{\FSTACK}[2]{{\tt \bfseries
    #1\begin{tabular}[t]{@{}l@{}}#2\end{tabular}}}
\newcommand{\STACK}[1]{\begin{tabular}[t]{@{}l@{}}
                        #1\end{tabular}}

\newcommand{\ITEM}{\hspace*{-0.2in}}
\newcommand{\TTITEM}[1]{\hspace*{-0.2in}{\TT{#1}}\\}
\newcommand{\BFITEM}[1]{\hspace*{-0.2in}{{\bf #1}}\\}

\newcommand{\STAR}{{\Large $^\star$}}
\newcommand{\PLUS}[1][]{{$^{+#1}$}}
\newcommand{\QMARK}{{$^{\,\mbox{\footnotesize ?}}$}}

\begin{document}
        
\title{Educational Problem Manager\\
Design Manual}

\author{Robert L. Walton}

\date{July 21, 2020}
 
\maketitle

\begin{center}
{\large \bf Notice}
\\[2ex]
\begin{minipage}{5.5in}
The authors have placed EPM (its files and the content of these files) in
the public domain; they make no warranty and accept
no liability for EPM.
\end{minipage}
\end{center}
\begin{center}
\large \bf Table of Contents
\end{center}

\bigskip

\tableofcontents 

\newpage

\section{Introduction}

This document gives design information for EPM system maintainers.
This document supplements the EPM Help Page documentation for
users and comments in code files for programmers.

\section{Definitions and Principals}

\subsection{Names}

\begin{enumerate}
\item Names chosen by the user consists of letters, digits,
dash({\tt -}), and underscore({\tt \_}), begin with a letter,
and end with a letter or digit.
See {\tt /include/parameters.php} {\tt \$epm\_name\_re}.
\item Visible file basenames consist of letters, digits, dash({\tt -}), and
underscore({\tt \_}), begin with a letter or digit, and end
with a letter or digit.  Visible extensions, if present, obey the
same rules.
\item Visible problem file basenames end with the
      problem name, which may optionally be preceded by a dash({\tt -}) but
      not by any other character.
      See {\tt /include/parameters.php} {\tt \$epm\_filename\_re}.
\item Invisible problem
      file and directory names begin and end with plus({\tt +}).
\item Administrative files may follow other rules.  In particular,
      email addresses have a file with a name that is the URL encoded email
      address, and browser tickets have a file with a name that is the
      32 hex digit ticket itself.
\end{enumerate}

\subsection{Times}

\begin{enumerate}
\item Times are UTC formatted as per {\tt "\%FT\%T\%z"}.
      See {\tt /include/parameters.php}\\ {\tt \$epm\_time\_format}.
\end{enumerate}

\subsection{Account IDs}

\begin{enumerate}
\item Account IDs (AIDs) are user choosen names.  They are unique to the
      account and used for both external and internal identification.
      Once assigned, they cannot be changed.
\item There are two kinds of AIDs: user UIDs for individual users,
      and team TIDs for teams.
\end{enumerate}

\subsection{Random IDs}

\begin{enumerate}
\item A random ID is a 32 hexadecimal digit number, or equivalently
      a 128-bit number.  Several are generated from /dev/random
      the first time the server is used, and thereafter they
      are generated as a pseudo-random sequence using previously
      generated values to aes-128-cbc encrypt previous values.
\item Browser TICKETS are random IDs.
\item The \$ID variable is a random ID used to validate
      both POST and GET requests from pages.
      
      For each tab, and
      sometimes for the view window, the first GET for the tab
      or window generates the first \$ID value for the pages
      that will occupy the tab or window, and thereafter each
      request is checked to see if it has the right \$ID value,
      and a new \$ID value is generated for the next tab or
      window contents.
\end{enumerate}

\subsection{Tabs and Windows}

\begin{enumerate}
\item There are specific tabs and windows for different kinds
of transations.  The \TT{main} window is for non-problem specific
transations.  For each account problem there is a problem-specific
window for transactions on that problem.  There is a \TT{view}
pop-up window for looking at files and information, and a
separate \TT{help} pop-up window for the Help Page and Guide Page.

\item Pages are assigned to windows.  E.g., the Login, Project,
User, Manage, List Edit, and Favorites Edit Pages are assigned
to the main tab, the
Problem, Option, and Run Pages are assigned to problem tabs,
and the View and Template Pages are assigned to the view pop-up
window.

\item At any given time a tab or window has a current page.
The page is initially opened with a GET.  Subsequent
transactions on that page are done with POSTs.  Each POST to
a page is checked to be sure that page is the current page for
its the window type.  So if you have opened the Project Page
in the main tab, you cannot POST to the User Page.

\item Transactions within a tab are sequenced, so that
if a transaction is out of sequence the tab becomes
\key{orphaned} and must be closed.
Sequencing prevents two main
tabs from existing at the same time, or two problem tabs
for the same problem existing at the same time.

Sequencing is done
by random sequence IDs that are attached to each page.
The next request must contain the current ID else the
tab is orphaned.  For the main tab the Login Page initializes
the tab's ID sequence.  For problem tabs the Problem Page
initializes the sequence.
\end{enumerate}

\section{Data Files}

\begin{center}
\begin{tabular}{|l|l|l|l|l|l|}
\hline
Name & Format & Description & Creators & Updaters & Readers \\
\hline\hline
\TT{admin} & dir & \STACK{administrative\\files}
	& user & & \\ 
\hline
\TT{admin/+blocking+} & dir & \STACK{email blocking\\control file}
	& (editor) & (editor ) & login \\ 
\hline
\TT{admin/motd.html} & html & \STACK{message\\of the day}
	& (editor) & (editor ) & login \\ 
\hline
\TT{admin/+lock+} & lock & \STACK{administrative\\lock file}
	& (lockers) & \STACK{login\\user\\team} & \\ 
\hline
\TT{admin/+actions+} & lines &
        \STACK{log of\\administrative\\actoins \pagref{ADMINISTRATIVE-ACTIONS}}
	& (updaters) & \STACK{user\\team} & view \\ 
\hline
\TT{admin/browser} & dir & \STACK{browser\\tickets}
	& login & & \\ 
\hline
\TT{admin/browser/TICKET} & 1-line
        & \STACK{ticket info\\\pagref{ADMIN/TICKET/TICKET}}
	& login & & login \\ 
\hline
\TT{admin/email} & dir & email files
	& login & & \\ 
\hline
\TT{admin/email/EMAIL} & 1-line
        & \STACK{email info\\\pagref{ADMIN/EMAIL/EMAIL}}
	& \STACK{user\\team} & \STACK{login\\user\\team}
	                     & \STACK{login\\user\\team} \\ 
\hline
\TT{admin/users} & dir & \STACK{administrative\\user\\directories}
	& user & & \\ 
\hline
\TT{admin/users/UID} & dir & \STACK{administrative\\UID user files}
	& \STACK{user\\team} & & \\ 
\hline
\FSTACK{admin/}{users/UID/\\PID.login} & lines
        & \STACK{log of logins\\\pagref{ADMIN/USERS/UID/PID.LOG}}
	& (updaters) & \STACK{login\\user\\team} & (login)  \\ 
\hline
\FSTACK{admin/}{users/UID/\\PID.inactive} & lines
	& \STACK{inactive\\.login files \pagref{ADMIN/USERS/UID/PID.INACTIVE}}
	& team & & \\ 
\hline
\FSTACK{admin/}{users/UID/\\UID.info} & json
	& \STACK{user info\\\pagref{ADMIN/USERS/UID/UID.INFO}}
	& user & & user \\ 
\hline
\FSTACK{admin/}{users/UID/\\+actions+} & lines
        & \STACK{log of user's\\administrative\\
	         actions \pagref{ADMINSTRATIVE-ACTIONS}}
	& (updaters) & \STACK{user\\team} & view \\ 
\hline
\end{tabular}
\end{center}

\begin{center}
\begin{tabular}{|l|l|l|l|l|l|}
\hline
Name & Format & Description & Creators & Updaters & Readers \\
\hline\hline
\TT{users} & dir & \pagref{USERS} & login & user & \\ 
\hline
\TT{users/UID} & dir & \pagref{USERS/UID}
	& user & \STACK{problem\\project} & \\ 
\hline
\TT{users/UID/+lists+} & dir & \pagref{USERS/UID/+LISTS+}
	& user & \STACK{list\\favorites} & project \\ 
\hline
\TT{users/UID/PROBLEM} & dir & \pagref{USERS/UID/PROBLEM}
	& \STACK{problem\\project} & & \\ 
\hline
\FSTACK{users/}{UID/PROBLEM/\\PROBLEM.cc}
    & C++ & \pagref{USERS/UID/PROBLEM/PROBLEM.cc}
    	& \STACK{problem\\(upload)} & & \\ 
\hline
\TT{projects} & dir & \pagref{PROJECTS} & login & maint & \\ 
\hline
\TT{solutions} & dir & \pagref{SOLUTIONS} & login & maint & \\ 
\hline
\end{tabular}
\end{center}

\section{Session Variables}

\begin{center}
\begin{tabular}{|l|l|l|l|l|l|}
\hline
Name & Description & Creators & Updaters & Readers \\
\hline\hline
\TT{EPM\_EMAIL} & \STACK{login email}
                & login & & all pages \\ 
\hline
\TT{EPM\_UID} & user ID & \STACK{login\\user} & & all pages \\ 
\hline
\TT{EPM\_PID} & personal ID & \STACK{login\\user} & & \STACK{login\\user} \\ 
\hline
\TT{EPM\_IPADDR} & \STACK{session\\IP address}
                 & login & & \STACK{index\\login\\user} \\ 
\hline
\TT{EPM\_TIME} & \STACK{session\\time}
                 & login & & \STACK{index\\login\\user} \\ 
\hline
\TT{EPM\_ID\_GEN} & \$ID generation
                 & index & index & index  \\ 
\hline
\TT{EPM\_ABORT} & \STACK{session\\abort info}
                 & \STACK{login\\user} & & index \\ 
\hline
\end{tabular}
\end{center}

\section{Web Pages}

\subsection{Login Page}

\begin{center}
{\bf Login Page Requires}
\\[1ex]
\begin{tabular}{l}
\TT{page/index.php} \\
\TT{include/epm\_random.php} \\
\end{tabular}
\\[3ex]
{\bf Login Page Files}
\\[1ex]
\begin{tabular}{lllll}
\TT{admim/ticket/TICKET}	& create  & -      & read \\
\TT{admim/email/EMAIL}	& -       & update & read \\
\TT{admim/users/UID/login/PID.login}
			& -       & append & - \\
\end{tabular}
\\[3ex]
{\bf Login Page Session Data}
\\[1ex]
\begin{tabular}{lllll}
\TT{EPM\_EMAIL}	& create  & -      & read \\
\TT{EPM\_UID}	& create  & -      & read    \\
\TT{EPM\_IPADDR}& create  & -      & read \\
\TT{EPM\_TIME}
                & create  & -      & read \\
\TT{EPM\_ABORT}
                & create  & -      & - \\
\end{tabular}
\end{center}

\subsubsection{Login Page File Formats}

\begin{indpar}
\begin{itemlist}
\item[\TT{admin/browser/TICKET} (ticket file):] T TID EMAIL
\label{ADMIN/TICKET/TICKET} \\
\begin{tabular}[t]{lp{4.0in}}
TICKET & ticket proper; 32 hexadecimal digit ticket number \\
T & ticket type; `c' for confirmation number; `a' for automatic \\
TID & team ID or '-' if none (i.e., ticket is for personal account) \\
EMAIL & Email address \\
\end{tabular}
\\
\begin{itemize}
\item When a person initially logs in to create an account,
the UID is not known when the ticket is created.
\end{itemize}

\item[\TT{admin/email/EMAIL} (regular email file):] PID ACOUNT ATIME
\label{ADMIN/EMAIL/EMAIL} \\
\begin{tabular}[t]{lp{4.0in}}
EMAIL & Email address encoded with PHP rawurlencode \\
PID & Personal user ID \\
ACOUNT & Number of auto-login periods completed so far. \\
ATIME & Start time of newest (incomplete) auto-login period. \\
\end{tabular}

\item[\TT{admin/email/EMAIL} (pre-login email file):] - TID ...
\label{ADMIN/EMAIL/EMAIL-ALTERNATE} \\
\begin{tabular}[t]{lp{4.0in}}
EMAIL & Email address encoded with PHP rawurlencode \\
TID & Team user ID (may be more than one) \\
\end{tabular}
\\
\begin{itemize}
\item This form of email file is created by the Team Page when
a team member is assigned the given EMAIL before the member
has an account.  The TID's list \underline{all} the team user IDs that
\underline{might} have a member which is this EMAIL and not a PID.
A TID might be listed whose
TID.info file no longer contains the EMAIL.
\\[1ex]
When the pre-login form is converted to a regular form,
the list of TID's is used to convert any matching EMAIL members
in TID.info files to PID members.
\end{itemize}

\item[\TT{admin/users/UID/PID.login} (login log):]~
\label{ADMIN/USERS/UID/PID.LOG} \\
Lines of format:\hspace{0.5in}TIME EMAIL IPADDR BROWSER \\
\begin{tabular}[t]{@{\hspace{0.2in}}lp{3.9in}}
UID & User ID; equals team UID for teams \\
PID & Personal ID; equals UID for personal users \\
TIME & Session time (EPM\_TIME) for login \\
EMAIL & Email address used for login \\
IPADDR & IP address for session, or `\TT{-}' if creation record \\
BROWSER & \STACK{
          \$\_SERVER['HTTP\_USER\_AGENT'] with `(...)'s\\
	  removed and horizontal spaces replaced by `\TT{;}'s;\\
	  or `\TT{-}' if creation record}
\end{tabular}
\\
\begin{itemize}
\item
A login with full name UID:PID is valid iff this file exists.
\item If UID is a team ID, the first line is a creation record
written when UID:PID is created.  No other line is a creation record.
\item This file name and modification time is stored in
EPM\_ABORT and used to abort a session if another session
logs in with the same UID:PID.
\end{itemize}

\item[\TT{admin/users/UID/PID.inactive}:]~
\label{ADMIN/USERS/UID/PID.INACTIVE} \\
Inactive login log file, made by renaming active file
when PID is no longer a member
of UID team.  May be reactivated.


\end{itemlist}
\end{indpar}

\subsubsection{Login Page Session Variables}

\begin{indpar}
\begin{tabular}[t]{lp{4.0in}}
\TT{EPM\_EMAIL}\label{EPM_EMAIL}
    & EMAIL entered by user into browser; set by Login Page when either
      (1) sent by browser, or (2) browser sends TICKET which identifies
      EMAIL.  Generally set before EPM\_UID set.
\\[0.5ex]
\TT{EPM\_UID}\label{EPM_UID}
    & User ID, either personal or team; set by Login Page when a valid
      TICKET is received, and set by User Page for new users.
\\[0.5ex]
\TT{EPM\_PID}\label{EPM_PID}
    & Personal ID; equals EPM\_UID if that is personal.  Otherwise the full
      account name is UID:PID where UID is a team ID.
      Set when EPM\_UID is set.
\\[0.5ex]
\TT{EPM\_IPADDR}\label{EPM_IPADDR}
    & Set to \$\_SERVER['REMOTE\_ADDR'] by Login Page if EPM\_UID is
      not yet set.
\\[0.5ex]
\TT{EPM\_TIME}\label{EPM_TIME}
    & Set to \$\_SERVER['REQUEST\_TIME'] formatted by \$epm\_format\_time
      by Login Page if EPM\_UID is not yet set.
\\[0.5ex]
\TT{EPM\_ABORT}\label{EPM_ABORT}
    & Set to [FILE,MTIME] where MTIME is the mod time of \$epm\_data/FILE
      and the session must abort if the mod time of this file changes.
      Here FILE is admin/users/UID/PID.login to which a line is appended
      whenever EPM\_UID is set for a session.
\end{tabular}
\end{indpar}


\subsubsection{Login Page Transactions}

\begin{enumerate}
\item If regular form admin/emails/EMAIL exists for EMAIL provided by
      user to browser, log existing
      user in and go to Project Page.
\item Otherwise, give
      the browser a valid ticket and go to User Page.
\end{enumerate}


\subsection{User}

\begin{center}
{\bf User Page Files}
\\[1ex]
\begin{tabular}{lllll}
\TT{admim/browser/BID}	& create  & update & read \\
\TT{admim/email/EMAIL}	& -       & update & read \\
\TT{admim/login.login}	& create  & update & -    \\
\end{tabular}
\\[3ex]
{\bf User Page Session Data}
\\[1ex]
\begin{tabular}{lllll}
\TT{EPM\_EMAIL}	& -       & -      & read \\
\TT{EPM\_UID}	& create  & -      & read \\
\TT{EPM\_IPADDR}& -       & -      & read \\
\TT{EPM\_TIME}
                & -       & -      & read \\
\end{tabular}
\end{center}

\subsubsection{User Page File Formats}

\begin{indpar}
\begin{itemlist}
\item[\TT{admin/users/UID/UID.info} (user info file):]~
\label{ADMIN/USERS/UID/UID.INFO} \\
JSON file with the following components:
\begin{tabular}[t]{ll}
\TT{'uid'} & UID (PID for person, team UID for team) \\
\TT{'sponsor'} & PID; missing if not team \\
\TT{'manager'} & PID; missing if not team \\
\TT{'emails'} & \TT{[} EMAIL \{ \TT{,} EMAIL \}\STAR{} \TT{]};
                missing if team \\
\TT{'members'} & \TT{[} MID \{ \TT{,} MID \}\STAR{} \TT{]};
                missing if not team \\
\TT{'full\_name'} & TEXT \\
\TT{'organization'} & TEXT \\
\TT{'location'} & TEXT \\
\end{tabular}
\\
where
\\
\begin{tabular}[t]{lp{4.0in}}
MID & member ID; PID if available or EMAIL not yet assigned to a user
      personal account otherwise (EMAIL has `\TT{@}' and PID does not) \\
TEXT & plain text \\
\end{tabular}
\\
\begin{itemize}
\item When a team UID.info file is created, MIDs are specified
as EMAILs which are resolved if possible to PIDs.
\item When a person initially creates an account, all
UID.info files are searched and if any have MIDs matching
the new account EMAIL, they are resolved to PIDs.
\end{itemize}

\end{itemlist}
\end{indpar}

\subsubsection{User Page Transactions}

\begin{enumerate}
\item If EPM\_UID not set, get data for new user and create
      new user account if data acceptable.
\item If EPM\_UID exists for a personal account, display
      user data and allow it to be edited.
\item If EPM\_UID exists for a team account (as discovered
      by reading UID.info), go to Team Page.
\end{enumerate}

\subsection{Problem}

\begin{center}
{\bf Problem Page Files}
\\[1ex]
\begin{tabular}{lllll}
\TT{users/UID/PROBLEM}	                & create  & update & read & delete
\\[1ex]
\TT{users/UID/PROBLEM/PROBLEM.tex}	& upload  & -      & read & delete \\
\TT{users/UID/PROBLEM/PROBLEM.pdf}	& create  & -      & read & delete
\\[1ex]
\TT{users/UID/PROBLEM/PROBLEM.c}	& upload  & -      & read & delete \\
\TT{users/UID/PROBLEM/PROBLEM.cc}	& upload  & -      & read & delete \\
\TT{users/UID/PROBLEM/PROBLEM.java}	& upload  & -      & read & delete \\
\TT{users/UID/PROBLEM/PROBLEM.py}	& upload  & -      & read & delete \\
\TT{users/UID/PROBLEM/PROBLEM}		& create  & -      & read & delete \\
\TT{users/UID/PROBLEM/PROBLEM.class}	& create  & -      & read & delete \\
\TT{users/UID/PROBLEM/PROBLEM.pyc}	& create  & -      & read & delete
\\[1ex]
\TT{users/UID/PROBLEM/XXXX-PROBLEM.c}	& upload  & -      & read & delete \\
\TT{users/UID/PROBLEM/XXXX-PROBLEM.cc}	& upload  & -      & read & delete \\
\TT{users/UID/PROBLEM/XXXX-PROBLEM.java}& upload  & -      & read & delete \\
\TT{users/UID/PROBLEM/XXXX-PROBLEM.py}	& upload  & -      & read & delete \\
\TT{users/UID/PROBLEM/XXXX-PROBLEM}	& create  & -      & read & delete \\
\TT{users/UID/PROBLEM/XXXX-PROBLEM.class}
					& create  & -      & read & delete \\
\TT{users/UID/PROBLEM/XXXX-PROBLEM.pyc}	& create  & -      & read & delete
\\[1ex]
\TT{users/UID/PROBLEM/XXXX-PROBLEM.in}	& upload  & -      & read & delete \\
\TT{users/UID/PROBLEM/XXXX-PROBLEM.sin}	& create  & -      & read & delete \\
\TT{users/UID/PROBLEM/XXXX-PROBLEM.sout}& create  & -      & read & delete \\
\TT{users/UID/PROBLEM/XXXX-PROBLEM.fout}& create  & -      & read & delete \\
\TT{users/UID/PROBLEM/XXXX-PROBLEM.ftest}& create  & -      & read & delete \\
\TT{users/UID/PROBLEM/XXXX-PROBLEM.dout}& create  & -      & read & delete \\
\TT{users/UID/PROBLEM/XXXX-PROBLEM.score}& create  & -      & read & delete \\
\end{tabular}
\\[3ex]
{\bf Problem Page Session Data}
\\[1ex]
\begin{tabular}{lllll}
\TT{EPM\_EMAIL}	& -       & -      & read \\
\TT{EPM\_UID}	& -       & -      & read \\
\TT{EPM\_PROBLEM}
		& create  & update & read \\
\end{tabular}
\end{center}

\section{Overview}

Here we list adminstrative files and transactions, and give a
brief description of each.

\subsection{Administrative Files}

EPM uses administrative files to direct generation of files from
other files, to keep track of visibility
permissions, and for other things.  All these files are in JSON
format.  EPM does \underline{not} use any data base (like MYSQL).

Administrative files are \underline{not} uploadable by the user.
They are made by commands issued by the user to web pages, e.g.,
the \TT{PPPP.score} file is made by the user commanding
the \TT{PPPP.run} file, and the user can make their own
\TT{\ldots-PPPP.run} file using a web page.  When administrative
commands are made using a web page, the code associated with the
page checks that the file being made does not violate security.

The following administrative files the user will encounter.
Unless otherwise noted, these are visible to the user.

\begin{indpar}
\TTITEM{XXXX.mk}  File specifying how to make the file \TT{XXXX},
when this last file is generated from other files.  E.g.,
the \TT{UUUU/PPPP/00-000-PPPP.out.mk} file tells how to make
the \TT{UUUU/PPPP/00-000-PPPP.out} from 
the \TT{system/PPPP/00-000-PPPP.in},
the \TT{system\EOL /\EOL PPPP/\EOL generate-PPPP},
and \TT{UUUU/PPPP/PPPP}.

A \TT{XXXX.mk} file also tells how to make itself, so there is
no need for \TT{XXXX.mk.mk} files.  \TT{XXXX.mk} files are
made from template files.
\\[1ex]
\TTITEM{system/template/X.E->Y.F.tpl}
Template file used to make \TT{.mk} or other administrative
files.  A typical template file name ends with \TT{X.cc->X.tmpl}
and is used to make a \TT{X.mk} file that specifies how to
make a \TT{X} file from a \TT{X.cc} file, where \TT{X} is a
parameter to the template file.  In general single upper case
letters are used as parameter names for template files, and
may also appear in the names of the template files themselves.

Template files are located and used by code in web pages that
make administrative files.
\\[1ex]
\TTITEM{UUUU/credentials} Credential file for user.  Specifies
user email addresses, ip addresses, dates ip addresses last
certified and last used.
\\[1ex]
\TTITEM{UUUU/logins} Login history of user.
\\[1ex]
\TTITEM{UUUU/PPPP/uploads} Upload history of user for problem \TT{PPPP}.
Note that a user's uploads for a problem are automatically
checked into a per-user, per-problem \TT{git} database
which can be cloned by the user and partially inspected
(in particular to obtain difference listings) using EPM
web pages.
\\[1ex]
\TTITEM{UUUU/PPPP/runs} Run history of user for problem \TT{PPPP}.
\\[1ex]
\TTITEM{DDDD/user.perm} Permission control file for arbitrary
users for all files in directory \TT{DDDD} (e.g., in \TT{system},
\TT{system/PPPP}) and its subdirectories.
\\[1ex]
\TTITEM{DDDD/UUUU.perm} Permission control file for
user \TT{UUUU} and files in directory \TT{DDDD} (e.g., in directory
\TT{UUUU}).
\end{indpar}

In the above, \TT{system/} is actually a project directory.
There can be many project, and the \TT{UUUU/PPPP/UUUU.perm} file
can point to any of them, in place of \TT{system/}.

\subsection{Transactions}

The only way a user can interact with EPM is via transactions.
Each transaction is executed by entering small amounts of text
on a web page and clicking appropriately.

The common transations are:

\begin{indpar}
\BFITEM{download}  Download any file visible to the user.
\\[1ex]
\BFITEM{inspect}  Inspect various visible JSON administrative files
in a more readable format.
\\[1ex]
\BFITEM{directory}  Create or destroy problem directories and designate
a current problem directory.
\\[1ex]
\BFITEM{upload}  Upload any program source (\TT{.c}, \TT{.cc}, \TT{.java},
\TT{.py}, or \TT{.lsp}) file or any program input (\TT{.in}) file into
the current problem directory.
\\[1ex]
\BFITEM{make}  Create, edit, and destroy \TT{.mk} files, whose existence
causes the associated derived files to be made upon demand, in the
current problem directory.
\\[1ex]
\BFITEM{run}  Create, edit, and destroy \TT{.run} files, which define
runs that cause batches of derived files to be created, in the
currrent problem directory.  Execute
designated runs.
\\[1ex]
\BFITEM{permission}  Create, edit, and destroy \TT{.perm} files that control
permissions and visibility.
\\[1ex]
\BFITEM{credentials}  Inspect and remove credentials of the current user.
\\[1ex]
\BFITEM{project}  Create or destroy project directories and designate
project directories that are visible to the current problem directory.
\\[1ex]
\BFITEM{move}  Move files between the current problem directory and a
project directory.
\end{indpar}

Program source files do not have to be problem solution files.
Any program can be run so long as it opens no files and does
all its input/output via file descriptors.  Program output
can be put into \TT{.out}, \TT{.fout}, \TT{.debug}, \TT{.info}, or
\TT{.disp} files.  The last kind of file encodes X-windows commands
that can be displayed in an X-window or pdf window or placed in a
\TT{.pdf} file.  Programs an also interact with terminal windows;
for example, a program can be written to calculate combinations
(i.e., N choose K).

Problem solution programs are run without arguments, unless they
are begin debugged, in which case their output is put into \TT{.debug}
files.  Other programs can be run with or without arguments.



\end{document}
